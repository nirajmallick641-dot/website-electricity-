<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>AI Electricity Theft Detection - Advanced</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap');

body{
    margin:0;
    font-family:'Orbitron', sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    background-size: 400% 400%;
    animation: gradientMove 15s ease infinite;
    color:white;
}

@keyframes gradientMove {
    0%{background-position:0% 50%;}
    50%{background-position:100% 50%;}
    100%{background-position:0% 50%;}
}

header{
    padding:20px;
    text-align:center;
    font-size:24px;
    letter-spacing:2px;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    border-bottom:1px solid rgba(255,255,255,0.2);
}

.container{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
    gap:25px;
    padding:30px;
}

.card{
    background: rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:20px;
    padding:25px;
    backdrop-filter: blur(15px);
    box-shadow: 0 0 20px rgba(0,255,255,0.2);
    transition: all 0.3s ease;
}

.card:hover{
    transform: translateY(-5px);
    box-shadow: 0 0 30px rgba(0,255,255,0.6);
}

button{
    padding:10px 22px;
    border:none;
    border-radius:30px;
    cursor:pointer;
    font-weight:bold;
    background: linear-gradient(45deg, #00f5ff, #0088ff);
    color:black;
    transition: 0.3s ease;
    box-shadow:0 0 15px #00f5ff;
}

button:hover{
    transform: scale(1.05);
    box-shadow:0 0 25px #00f5ff;
}

input,select{
    padding:10px;
    border-radius:20px;
    border:none;
    outline:none;
    background: rgba(255,255,255,0.15);
    color:white;
    width:100%;
    margin-top:10px;
}

.alert-active{
    background: linear-gradient(45deg, #ff0000, #ff6a00) !important;
    animation: pulse 1s infinite;
}

@keyframes pulse{
    0%{box-shadow:0 0 10px red;}
    50%{box-shadow:0 0 30px red;}
    100%{box-shadow:0 0 10px red;}
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}

td,th{
    border:1px solid rgba(255,255,255,0.2);
    padding:8px;
    text-align:center;
}

#alertBox{
    padding:15px;
    border-radius:15px;
    background: linear-gradient(45deg, #00ff99, #00cc66);
    font-weight:bold;
    text-align:center;
    box-shadow:0 0 20px #00ff99;
                     }
    
</style>
</head>

<body>

<header>AI Electricity Theft Detection - Advanced Dashboard</header>

<div class="container">

<div class="card">
<h3>Admin Login</h3>
<input type="password" id="adminPass" placeholder="Enter Admin Password">
<button onclick="login()">Login</button>
<p id="loginStatus"></p>
</div>

<div class="card">
<h3>System Control</h3>
<select id="zone">
<option>Zone 1</option>
<option>Zone 2</option>
<option>Zone 3</option>
</select>
<br><br>
<button onclick="startMonitoring()">Start Monitoring</button>
<p id="status">Status: Not Started</p>
<p>Total Alerts: <span id="alertCount">0</span></p>
</div>

<div class="card">
<h3>Live Alert</h3>
<div id="alertBox" style="padding:15px;border-radius:10px;background:#14532d;">
System Normal
</div>
</div>

<div class="card">
<h3>Live Sound Graph</h3>
<canvas id="soundChart"></canvas>
</div>

<div class="card">
<h3>Alert History</h3>
<button onclick="exportCSV()">Export CSV</button>
<table>
<thead>
<tr>
<th>Time</th>
<th>Zone</th>
<th>Status</th>
</tr>
</thead>
<tbody id="historyTable"></tbody>
</table>
</div>

</div>

<script>
let audioContext;
let analyser;
let microphone;
let dataArray;
let monitoring=false;
let alertCounter=0;
let historyData=[];
let chart;
let lastAlertTime=0;

function login(){
    let pass=document.getElementById("adminPass").value;
    if(pass==="admin123"){
        localStorage.setItem("adminLogged","true");
        document.getElementById("loginStatus").innerText="Login Successful";
    }else{
        document.getElementById("loginStatus").innerText="Wrong Password";
    }
}
    function startMonitoring(){
    if(localStorage.getItem("adminLogged")!=="true"){
        alert("Login First!");
        return;
    }

    if(monitoring) return;

    navigator.mediaDevices.getUserMedia({
        audio:{
            echoCancellation:false,
            noiseSuppression:false,
            autoGainControl:false
        }
    })
    .then(stream=>{
        audioContext=new (window.AudioContext || window.webkitAudioContext)();
        analyser=audioContext.createAnalyser();
        microphone=audioContext.createMediaStreamSource(stream);
        microphone.connect(analyser);

        analyser.fftSize=256;
        dataArray=new Uint8Array(analyser.frequencyBinCount);

        monitoring=true;
        document.getElementById("status").innerText="Monitoring...";
        initChart();
        monitorSound();
    })
    .catch(()=>{
        alert("Microphone permission denied or not supported.");
    });
    }
    
    function monitorSound(){
    if(!monitoring) return;

    analyser.getByteFrequencyData(dataArray);

    let sum = 0;
    for(let i=0;i<dataArray.length;i++){
        sum += dataArray[i];
    }

    let avg = sum / dataArray.length;

    updateChart(avg);

    let now = Date.now();

    // Lower threshold for better detection
    if(avg > 40 && now - lastAlertTime > 3000){
        lastAlertTime = now;
        triggerAlert();
    }

    requestAnimationFrame(monitorSound);
    }
    

function initChart(){
    const ctx=document.getElementById('soundChart').getContext('2d');
    chart=new Chart(ctx,{
        type:'line',
        data:{
            labels:[],
            datasets:[{
                label:'High Frequency Level',
                data:[],
                borderWidth:2
            }]
        },
        options:{
            animation:false,
            responsive:true,
            scales:{
                y:{beginAtZero:true}
            }
        }
    });
}


function updateChart(value){
    if(!chart) return;

    if(chart.data.labels.length>40){
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
    }

    chart.data.labels.push('');
    chart.data.datasets[0].data.push(value);
    chart.update();
}

function triggerAlert(){
    let alertBox=document.getElementById("alertBox");
    alertBox.innerText="âš  Theft Alert!";
    alertBox.classList.add("alert-active");

    alertCounter++;
    document.getElementById("alertCount").innerText=alertCounter;

    let zone=document.getElementById("zone").value;
    let time=new Date().toLocaleString();

    historyData.push({time,zone,status:"Theft Detected"});
    addHistory(time,zone);

    setTimeout(()=>{
        alertBox.innerText="System Normal";
        alertBox.classList.remove("alert-active");
    },3000);
}

function addHistory(time,zone){
    let row=document.createElement("tr");
    row.innerHTML=`<td>${time}</td><td>${zone}</td><td>Theft Detected</td>`;
    document.getElementById("historyTable").prepend(row);
}

function exportCSV(){
    if(historyData.length===0){
        alert("No data to export");
        return;
    }

    let csv="Time,Zone,Status\n";
    historyData.forEach(item=>{
        csv+=`${item.time},${item.zone},${item.status}\n`;
    });

    let blob=new Blob([csv],{type:"text/csv"});
    let link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="alert_report.csv";
    link.click();
}
</script>

</body>
</html>
